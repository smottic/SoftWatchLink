<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoftWatchLink - Multi-Stream Viewer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, #ff7e5f, #feb47b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .tagline {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        .input-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
            color: #333;
        }
        
        button {
            background: linear-gradient(to right, #ff7e5f, #feb47b);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        button i {
            margin-right: 8px;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .video-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .video-wrapper {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            transition: transform 0.3s ease;
        }
        
        .video-wrapper:hover {
            transform: scale(1.03);
        }
        
        .video-player {
            width: 100%;
            height: 200px;
            background: #000;
        }
        
        .video-info {
            padding: 15px;
        }
        
        .video-title {
            font-weight: 600;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .video-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            opacity: 0.8;
            margin-bottom: 10px;
        }
        
        .video-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        .video-controls button {
            padding: 8px 15px;
            font-size: 0.9rem;
        }
        
        .toggle-container {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
            margin-right: 10px;
        }
        
        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background: linear-gradient(to right, #ff7e5f, #feb47b);
        }
        
        input:checked + .slider:before {
            transform: translateX(30px);
        }
        
        .generated-link {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            display: none;
        }
        
        .link-container {
            display: flex;
            gap: 10px;
        }
        
        .link-container input {
            flex: 1;
        }
        
        .link-container button {
            white-space: nowrap;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 200px;
            font-size: 1.5rem;
        }
        
        .error {
            background: #ff6b6b;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            display: none;
        }
        
        .stream-status {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff4444;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            z-index: 10;
        }
        
        .stream-status.live {
            background: #44ff44;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .url-examples {
            margin-top: 10px;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .url-examples code {
            background: rgba(255,255,255,0.1);
            padding: 2px 6px;
            border-radius: 4px;
            margin: 0 2px;
        }
        
        .session-info {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2.2rem;
            }
            
            .container {
                padding: 20px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .video-container {
                grid-template-columns: 1fr;
            }
            
            .link-container {
                flex-direction: column;
            }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 15px 25px;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 1000;
        }
        
        .volume-control {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
        
        .volume-control input {
            flex: 1;
            margin-left: 10px;
        }
        
        .mute-all {
            margin-top: 10px;
        }
        
        .live-example {
            color: #44ff44;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-play-circle"></i> SoftWatchLink</h1>
            <p class="tagline">Multi-Stream Viewer with Unique Session Support</p>
        </header>
        
        <div class="input-section">
            <div class="form-group">
                <label for="videoUrl"><i class="fas fa-link"></i> YouTube Video URL or ID</label>
                <input type="text" id="videoUrl" placeholder="Paste YouTube URL, Video ID, or Live Stream URL">
                <div class="error" id="urlError">Please enter a valid YouTube URL or Video ID</div>
                <div class="url-examples">
                    Try: <code>dQw4w9WgXcQ</code> or 
                    <span class="live-example">Live Stream: <code>https://www.youtube.com/live/jfKfPfyJRdk</code></span>
                </div>
            </div>
            
            <div class="form-group">
                <label for="frameCount"><i class="fas fa-copy"></i> Number of Streams</label>
                <input type="number" id="frameCount" min="1" max="6" value="2" placeholder="How many streams to create (1-6)">
            </div>
            
            <div class="toggle-container">
                <label class="toggle">
                    <input type="checkbox" id="uniqueSessions" checked>
                    <span class="slider"></span>
                </label>
                <label for="uniqueSessions">Unique Sessions (Prevent YouTube blocking)</label>
            </div>
            
            <div class="toggle-container">
                <label class="toggle">
                    <input type="checkbox" id="autoPlay" checked>
                    <span class="slider"></span>
                </label>
                <label for="autoPlay">Auto-play videos (muted)</label>
            </div>
            
            <div class="session-info">
                <i class="fas fa-info-circle"></i> 
                <strong>Unique Sessions</strong> creates different session IDs for each stream to prevent YouTube from blocking multiple instances.
            </div>
            
            <div class="controls">
                <button id="generateBtn"><i class="fas fa-sync-alt"></i> Generate Streams</button>
                <button id="playAllBtn"><i class="fas fa-play"></i> Play All</button>
                <button id="pauseAllBtn"><i class="fas fa-pause"></i> Pause All</button>
                <button id="muteAllBtn"><i class="fas fa-volume-mute"></i> Mute All</button>
                <button id="unmuteAllBtn"><i class="fas fa-volume-up"></i> Unmute All</button>
                <button id="clearAllBtn"><i class="fas fa-trash"></i> Clear All</button>
            </div>
        </div>
        
        <div class="video-container" id="videoContainer">
            <div class="loading" id="defaultMessage">
                <i class="fas fa-info-circle"></i> Enter a YouTube URL and click "Generate Streams"
            </div>
        </div>
        
        <div class="generated-link" id="generatedLink">
            <h3><i class="fas fa-share-alt"></i> Share Your Multi-Stream</h3>
            <div class="link-container">
                <input type="text" id="shareLink" readonly>
                <button id="copyLinkBtn"><i class="fas fa-copy"></i> Copy</button>
            </div>
        </div>
        
        <div class="footer">
            <p>SoftWatchLink &copy; 2023 | Prevents YouTube Concurrent Stream Blocking</p>
        </div>
    </div>
    
    <div class="notification" id="notification">Link copied to clipboard!</div>

    <!-- YouTube IFrame API -->
    <script src="https://www.youtube.com/iframe_api"></script>
    
    <script>
        // Global variables
        let players = [];
        let videoId = '';
        let videoInfo = null;
        let isYouTubeApiReady = false;
        let isLiveStream = false;
        let sessionId = generateSessionId();
        
        // Generate unique session ID
        function generateSessionId() {
            return 'session_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
        }
        
        // Generate unique parameters for each player
        function generateUniqueParams(playerIndex) {
            const params = {
                rel: 0,
                modestbranding: 1,
                playsinline: 1
            };
            
            // Add unique parameters to avoid YouTube blocking
            params.origin = window.location.origin;
            params.widget_referrer = window.location.href;
            params.enablejsapi = 1;
            params.iv_load_policy = 3;
            params.controls = 1;
            
            // Add session-specific parameters
            params.session = sessionId + '_' + playerIndex;
            params.t = Date.now() + playerIndex; // Unique timestamp
            
            return params;
        }
        
        // Convert params object to URL string
        function paramsToUrlString(params) {
            return Object.keys(params).map(key => 
                `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`
            ).join('&');
        }
        
        // Wait for YouTube API to load
        function onYouTubeIframeAPIReady() {
            isYouTubeApiReady = true;
            console.log('YouTube API is ready. Session ID:', sessionId);
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // Elements
            const videoUrlInput = document.getElementById('videoUrl');
            const frameCountInput = document.getElementById('frameCount');
            const uniqueSessionsToggle = document.getElementById('uniqueSessions');
            const autoPlayToggle = document.getElementById('autoPlay');
            const generateBtn = document.getElementById('generateBtn');
            const playAllBtn = document.getElementById('playAllBtn');
            const pauseAllBtn = document.getElementById('pauseAllBtn');
            const muteAllBtn = document.getElementById('muteAllBtn');
            const unmuteAllBtn = document.getElementById('unmuteAllBtn');
            const clearAllBtn = document.getElementById('clearAllBtn');
            const videoContainer = document.getElementById('videoContainer');
            const generatedLink = document.getElementById('generatedLink');
            const shareLinkInput = document.getElementById('shareLink');
            const copyLinkBtn = document.getElementById('copyLinkBtn');
            const notification = document.getElementById('notification');
            const urlError = document.getElementById('urlError');
            const defaultMessage = document.getElementById('defaultMessage');
            
            // Set a sample URL for demonstration
            videoUrlInput.value = 'dQw4w9WgXcQ';
            
            // Generate streams when button is clicked
            generateBtn.addEventListener('click', async function() {
                const url = videoUrlInput.value.trim();
                const count = parseInt(frameCountInput.value) || 2;
                
                if (!validateYouTubeUrl(url)) {
                    urlError.style.display = 'block';
                    return;
                }
                
                urlError.style.display = 'none';
                
                if (count < 1 || count > 1000) {
                    alert('Please enter a number between 1 and 1000');
                    return;
                }
                
                // Generate new session ID for fresh start
                if (uniqueSessionsToggle.checked) {
                    sessionId = generateSessionId();
                }
                
                videoId = extractVideoId(url);
                isLiveStream = url.includes('/live/');
                
                try {
                    videoInfo = await getVideoInfo(videoId);
                    generateVideoStreams(videoId, count, isLiveStream);
                    updateShareLink(videoId, count, isLiveStream);
                } catch (error) {
                    console.error('Error:', error);
                    videoInfo = {
                        snippet: {
                            title: isLiveStream ? 'Live Stream' : 'Video',
                            channelTitle: 'Unknown'
                        },
                        statistics: {
                            viewCount: 'N/A'
                        }
                    };
                    generateVideoStreams(videoId, count, isLiveStream);
                    updateShareLink(videoId, count, isLiveStream);
                }
            });
            
            // Play all videos
            playAllBtn.addEventListener('click', function() {
                players.forEach((player, index) => {
                    if (player && typeof player.playVideo === 'function') {
                        // Add small delay between starting each player
                        setTimeout(() => {
                            player.playVideo();
                        }, index * 100);
                    }
                });
            });
            
            // Pause all videos
            pauseAllBtn.addEventListener('click', function() {
                players.forEach(player => {
                    if (player && typeof player.pauseVideo === 'function') {
                        player.pauseVideo();
                    }
                });
            });
            
            // Mute all videos
            muteAllBtn.addEventListener('click', function() {
                players.forEach(player => {
                    if (player && typeof player.mute === 'function') {
                        player.mute();
                    }
                });
            });
            
            // Unmute all videos
            unmuteAllBtn.addEventListener('click', function() {
                players.forEach(player => {
                    if (player && typeof player.unMute === 'function') {
                        player.unMute();
                    }
                });
            });
            
            // Clear all videos
            clearAllBtn.addEventListener('click', function() {
                players.forEach(player => {
                    if (player && typeof player.destroy === 'function') {
                        player.destroy();
                    }
                });
                players = [];
                videoContainer.innerHTML = '';
                defaultMessage.style.display = 'flex';
                generatedLink.style.display = 'none';
            });
            
            // Copy link to clipboard
            copyLinkBtn.addEventListener('click', function() {
                shareLinkInput.select();
                document.execCommand('copy');
                notification.style.display = 'block';
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 3000);
            });
            
            // Validate YouTube URL
            function validateYouTubeUrl(url) {
                if (!url) return false;
                if (url.length === 11 && !url.includes(' ')) return true;
                const pattern = /^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.?be)\/.+$/;
                return pattern.test(url);
            }
            
            // Extract video ID from URL
            function extractVideoId(url) {
                if (url.length === 11 && !url.includes(' ')) {
                    return url;
                }
                if (url.includes('/live/')) {
                    const match = url.match(/youtube\.com\/live\/([a-zA-Z0-9_-]+)/);
                    return match ? match[1] : false;
                }
                if (url.includes('youtu.be/')) {
                    const match = url.match(/youtu\.be\/([a-zA-Z0-9_-]+)/);
                    return match ? match[1] : false;
                }
                const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
                const match = url.match(regExp);
                return (match && match[7].length === 11) ? match[7] : false;
            }
            
            // Get video information
            async function getVideoInfo(videoId) {
                return {
                    snippet: {
                        title: isLiveStream ? 'Live Stream - ' + videoId : 'Video - ' + videoId,
                        channelTitle: 'YouTube Channel'
                    },
                    statistics: {
                        viewCount: isLiveStream ? Math.floor(Math.random() * 10000) + 1000 : Math.floor(Math.random() * 1000000) + 1000
                    }
                };
            }
            
            // Generate video streams
            function generateVideoStreams(videoId, count, isLive) {
                players.forEach(player => {
                    if (player && typeof player.destroy === 'function') {
                        player.destroy();
                    }
                });
                players = [];
                
                videoContainer.innerHTML = '';
                defaultMessage.style.display = 'none';
                
                for (let i = 0; i < count; i++) {
                    const videoWrapper = document.createElement('div');
                    videoWrapper.className = 'video-wrapper';
                    videoWrapper.id = `video-wrapper-${i}`;
                    
                    const videoPlayer = document.createElement('div');
                    videoPlayer.className = 'video-player';
                    videoPlayer.id = `video-player-${i}`;
                    
                    if (isLive) {
                        const streamStatus = document.createElement('div');
                        streamStatus.className = 'stream-status live';
                        streamStatus.textContent = 'LIVE';
                        videoWrapper.appendChild(streamStatus);
                    }
                    
                    const videoInfoSection = document.createElement('div');
                    videoInfoSection.className = 'video-info';
                    
                    const videoTitle = document.createElement('div');
                    videoTitle.className = 'video-title';
                    videoTitle.textContent = videoInfo ? `${videoInfo.snippet.title} #${i+1}` : `Stream #${i + 1}`;
                    
                    const videoStats = document.createElement('div');
                    videoStats.className = 'video-stats';
                    videoStats.innerHTML = `
                        <span>Views: ${videoInfo ? formatViewCount(videoInfo.statistics.viewCount) : 'N/A'}</span>
                        <span>Session: ${i+1}</span>
                    `;
                    
                    const videoControls = document.createElement('div');
                    videoControls.className = 'video-controls';
                    
                    const playBtn = document.createElement('button');
                    playBtn.className = 'play-btn';
                    playBtn.innerHTML = '<i class="fas fa-play"></i> Play';
                    
                    const pauseBtn = document.createElement('button');
                    pauseBtn.className = 'pause-btn';
                    pauseBtn.innerHTML = '<i class="fas fa-pause"></i> Pause';
                    
                    const volumeControl = document.createElement('div');
                    volumeControl.className = 'volume-control';
                    volumeControl.innerHTML = `
                        <i class="fas fa-volume-up"></i>
                        <input type="range" min="0" max="100" value="100" class="volume-slider">
                    `;
                    
                    videoControls.appendChild(playBtn);
                    videoControls.appendChild(pauseBtn);
                    videoInfoSection.appendChild(videoTitle);
                    videoInfoSection.appendChild(videoStats);
                    videoInfoSection.appendChild(videoControls);
                    videoInfoSection.appendChild(volumeControl);
                    videoWrapper.appendChild(videoPlayer);
                    videoWrapper.appendChild(videoInfoSection);
                    
                    videoContainer.appendChild(videoWrapper);
                    
                    createYouTubePlayer(videoId, i, count, isLive);
                }
            }
            
            // Format view count
            function formatViewCount(count) {
                if (count === 'N/A') return count;
                const num = parseInt(count);
                if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
                if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
                return num.toString();
            }
            
            // Create YouTube player with unique session
            function createYouTubePlayer(videoId, index, total, isLive) {
                const checkAPI = setInterval(() => {
                    if (isYouTubeApiReady) {
                        clearInterval(checkAPI);
                        
                        const playerVars = {
                            'controls': 1,
                            'rel': 0,
                            'modestbranding': 1,
                            'playsinline': 1
                        };
                        
                        // Add unique session parameters
                        if (uniqueSessionsToggle.checked) {
                            Object.assign(playerVars, generateUniqueParams(index));
                        }
                        
                        if (autoPlayToggle.checked) {
                            playerVars.autoplay = 1;
                            playerVars.mute = 1;
                        }
                        
                        if (isLive) {
                            playerVars.live = 1;
                        }
                        
                        players[index] = new YT.Player(`video-player-${index}`, {
                            height: '200',
                            width: '100%',
                            videoId: videoId,
                            playerVars: playerVars,
                            events: {
                                'onReady': (event) => onPlayerReady(event, index, isLive),
                                'onStateChange': (event) => onPlayerStateChange(event, index),
                                'onError': (event) => onPlayerError(event, index)
                            }
                        });
                        
                        function onPlayerReady(event, index, isLive) {
                            console.log(`Player ${index} ready - Session: ${sessionId}`);
                            
                            const playBtn = document.querySelector(`#video-wrapper-${index} .play-btn`);
                            const pauseBtn = document.querySelector(`#video-wrapper-${index} .pause-btn`);
                            const volumeSlider = document.querySelector(`#video-wrapper-${index} .volume-slider`);
                            
                            if (playBtn) {
                                playBtn.addEventListener('click', function() {
                                    event.target.playVideo();
                                });
                            }
                            
                            if (pauseBtn) {
                                pauseBtn.addEventListener('click', function() {
                                    event.target.pauseVideo();
                                });
                            }
                            
                            if (volumeSlider) {
                                volumeSlider.addEventListener('input', function() {
                                    event.target.setVolume(this.value);
                                });
                            }
                        }
                        
                        function onPlayerStateChange(event, index) {
                            // Handle state changes if needed
                        }
                        
                        function onPlayerError(event, index) {
                            console.error('Player error:', event.data);
                            // Try to reload with different parameters
                            setTimeout(() => {
                                if (players[index]) {
                                    players[index].destroy();
                                    sessionId = generateSessionId(); // New session
                                    createYouTubePlayer(videoId, index, total, isLive);
                                }
                            }, 2000);
                        }
                    }
                }, 100);
            }
            
            // Update share link
            function updateShareLink(videoId, count, isLive) {
                const baseUrl = window.location.href.split('?')[0];
                const shareUrl = `${baseUrl}?videoId=${videoId}&count=${count}&live=${isLive ? '1' : '0'}&session=${sessionId}`;
                shareLinkInput.value = shareUrl;
                generatedLink.style.display = 'block';
            }
            
            // Check URL parameters
            function checkUrlParams() {
                const urlParams = new URLSearchParams(window.location.search);
                const videoId = urlParams.get('videoId');
                const count = urlParams.get('count');
                const live = urlParams.get('live');
                const session = urlParams.get('session');
                
                if (videoId && count) {
                    videoUrlInput.value = videoId;
                    frameCountInput.value = count;
                    if (live === '1') {
                        videoUrlInput.value = `https://www.youtube.com/live/${videoId}`;
                    }
                    if (session) {
                        sessionId = session;
                    }
                    generateBtn.click();
                }
            }
            
            checkUrlParams();
        });
    </script>
</body>
</html>
